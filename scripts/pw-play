#!/bin/bash
# Wrapper for pw-play so LIVI works with PipeWire that doesn't support --raw.
# LIVI calls "pw-play --raw ..."; older pw-play doesn't know --raw. We strip
# --raw and add --format=s16 --rate=48000 --channels=2 instead, then call
# the real pw-play. Use REAL_PWPLAY to point to the real binary (default:
# pw-play.real if we are /usr/bin/pw-play, else /usr/bin/pw-play).
if [[ -n "$REAL_PWPLAY" ]]; then
  :
elif [[ -x /usr/local/bin/pw-play.real ]]; then
  REAL_PWPLAY=/usr/local/bin/pw-play.real
elif [[ -x /usr/bin/pw-play.real ]]; then
  REAL_PWPLAY=/usr/bin/pw-play.real
else
  REAL_PWPLAY=/usr/bin/pw-play
fi
args=()
removed_raw=false
while [[ $# -gt 0 ]]; do
  if [[ "$1" == "--raw" ]]; then
    removed_raw=true
    shift
    continue
  fi
  args+=("$1")
  shift
done
if [[ "$removed_raw" == true ]]; then
  # Real binary is pw-cat: needs --playback for playback mode
  exec "$REAL_PWPLAY" --playback --format=s16 --rate=44100 --channels=2 "${args[@]}"
else
  exec "$REAL_PWPLAY" "${args[@]}"
fi
